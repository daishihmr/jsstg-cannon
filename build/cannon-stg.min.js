/*
 * 破壊せよ！キャノンさん v0.0.1
 * http://www.dev7.jp
 * 
 * The MIT License (MIT)
 * Copyright © 2014 daishi_hmr, dev7.jp
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy of this software and
 * associated documentation files (the “Software”), to deal in the Software without restriction, including
 * without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies
 * of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following
 * conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all copies or substantial portions
 * of the Software.
 * 
 * THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */


var cannon={app:null,SC_W:900,SC_H:600,SHOT_SPEED:30,HEAT_BY_SHOT:15};cannon.optionSettings={seVolume:.5,bgmVolume:.5},tm.display.Label.default.fontFamily="OFL",cannon.ASSETS={fighter:"images/fighter.png",aura:"images/aura.png",shot:"images/shot.png",backfire:"images/backfire.png","sounds/extend":"sounds/extend.mp3"},Math.PHI=1.61803399,tm.main(function(){cannon.app=cannon.Application("#main"),cannon.app.fps=60,cannon.app.resize(cannon.SC_W,cannon.SC_H).fitWindow().replaceScene(tm.ui.LoadingScene({width:cannon.SC_W,height:cannon.SC_H,assets:cannon.ASSETS,nextScene:cannon.GameScene}));var a=document.createElement("span");a.style.fontFamily="'OFL', 'monospace'",a.innerHTML="QW@HhsXJ",document.body.appendChild(a);var b=a.offsetWidth,c=20,d=function(){c-=1,a.offsetWidth!==b||0>c?(document.body.removeChild(a),cannon.app.run()):setTimeout(d,100)};d()}),tm.define("cannon.Application",{superClass:"tm.display.CanvasApp",init:function(a){this.superInit(a),this.keyboard.element.addEventListener("keydown",function(a){37<=a.keyCode&&a.keyCode<=40&&a.preventDefault()},!1)}}),cannon.playSe=function(a){tm.asset.Manager.get(a).clone().setVolume(cannon.optionSettings.seVolume).play()},cannon.playBgm=function(a){tm.asset.Manager.get(a).clone().setVolume(cannon.optionSettings.bgmVolume).play()},tm.define("cannon.TitleScene",{superClass:"tm.app.Scene",init:function(){this.superInit(),this.setInteractive(!0),this.fromJSON({children:{title:{type:"tm.display.Label",init:["ETA Boost",72],x:.5*cannon.SC_W,y:cannon.SC_H*(1-1/Math.PHI)}}})},onpointingend:function(){var a=this;cannon.app.pushScene(cannon.MenuDialog("MENU",["game start","option"],["ゲームスタート","設定"]).on("selected",function(b){switch(b.value){case"game start":a.startGame()}}))},startGame:function(){cannon.app.replaceScene(cannon.GameScene())}}),tm.define("cannon.GameScene",{superClass:"tm.app.Scene",init:function(){this.superInit(),this.fromJSON({children:{backgroundLayer:{type:"tm.display.CanvasElement",children:{bg:{type:"cannon.Background"}}},playerLayer:{type:"tm.display.CanvasElement",children:{player:{type:"cannon.Fighter",scene:this}}},enemyLayer:{type:"tm.display.CanvasElement",children:{}},terrainLayer:{type:"tm.display.CanvasElement",children:{}},bulletLayer:{type:"tm.display.CanvasElement",children:{}}}})}}),tm.define("cannon.MenuDialog",{superClass:"tm.ui.MenuDialog",init:function(a,b,c,d){this.superInit({title:a,menu:b,menuDesctiptions:c,defaultIndex:d||0,showExit:!0,screenWidth:cannon.SC_W,screenHeight:cannon.SC_H,backgroundColor:"hsla(200, 80%, 5%, 0.9)",boxColor:"hsla(200, 80%, 10%, 0.9)",cursorColor:"hsla(200, 80%, 30%, 0.9)"}),this.on("preselected",function(){cannon.playSe("sounds/extend")}),this.on("canceled",function(){cannon.playSe("sounds/extend")})}}),tm.define("cannon.Fighter",{superClass:"tm.display.CanvasElement",scene:null,init:function(){this.superInit(),this.fromJSON({children:{aura:{type:"tm.display.Sprite",init:["aura",80,120],frameIndex:0,x:-50,y:5,scaleY:.75},body:{type:"tm.display.Sprite",init:["fighter",128,64],frameIndex:2}}}),this.beforeX=this.x=.5*cannon.SC_W,this.beforeY=this.y=.5*cannon.SC_H,this.speed=6,this.roll=0,this.heat=0,this.aura.update=function(a){this.setFrameIndex(a.frame%4),this.scaleX=[.8,1,1.2,1][a.frame%4]}},update:function(a){var b=a.keyboard,c=b.getKeyDirection();this.position.add(c.mul(this.speed)),this.x=Math.clamp(this.x,32,cannon.SC_W-32),this.y=Math.clamp(this.y,16,cannon.SC_H-16),c.y<0?this.roll-=.1:0<c.y?this.roll+=.1:(this.roll*=.9,-.01<this.roll&&this.roll<.01&&(this.roll=0)),this.roll=Math.clamp(this.roll,-2,2),this.body.setFrameIndex(~~(2+this.roll+.5)),b.getKeyDown("z")&&this.heat<=0&&(cannon.Shot().setPosition(this.x+50,this.y+10).addChildTo(this.parent),this.heat=cannon.HEAT_BY_SHOT),this.heat-=1}}),tm.define("cannon.Background",{superClass:"tm.display.CanvasElement",init:function(){this.superInit(),this.fromJSON({children:{bg:{type:"tm.display.Sprite",init:tm.graphics.Canvas().resize(cannon.SC_W,cannon.SC_H).setFillStyle("black").fillRect(0,0,cannon.SC_W,cannon.SC_H),originX:0,originY:0}}})}}),tm.define("cannon.Shot",{superClass:"tm.display.Sprite",init:function(){this.superInit("shot"),this.setScale(3)},update:function(){this.x+=cannon.SHOT_SPEED}});
//# sourceMappingURL=cannon-stg.min.js.map