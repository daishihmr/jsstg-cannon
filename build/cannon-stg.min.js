/*
 * 破壊せよ！キャノンさん v0.0.1
 * http://www.dev7.jp
 * 
 * The MIT License (MIT)
 * Copyright © 2014 daishi_hmr, dev7.jp
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy of this software and
 * associated documentation files (the “Software”), to deal in the Software without restriction, including
 * without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies
 * of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following
 * conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all copies or substantial portions
 * of the Software.
 * 
 * THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */


var cannon={};!function(){var a=960,b=640;cannon.app=null,cannon.SC_W=a,cannon.SC_H=b,cannon.FIGHTER_RADIUS=a/96,cannon.FIGHTER_SPEED=a/120,cannon.SHOT_SPEED=a/32,cannon.HEAT_BY_SHOT=25,cannon.SHOT_POWER=3,cannon.SHOT_RADIUS=a/96,cannon.currentStage=0,cannon.optionSettings={seVolume:.1,bgmVolume:.5},tm.display.Label.default.fontFamily="OFL",cannon.ASSETS={fighter:"images/fighter.png",aura:"images/aura.png",shot:"images/shot.png",backfire:"images/backfire.png",explode0:"images/exp_s.png",explode1:"images/exp_l.png",shockwave:"images/shockwave.png",spark:"images/spark.png",spark2:"images/spark2.png",boost:"images/boost.png",stage1:"genasset/stage1_half.png",test:"genasset/test.png","sounds/extend":"sounds/extend.mp3","sounds/reload":"sounds/sen_ge_gun_otosu03.mp3","sounds/shot":"sounds/gun2.mp3","sounds/explode0":"sounds/sen_ge_taihou03.mp3","sounds/explode1":"sounds/sen_ge_bom14.mp3"},Array.range(0,15).forEach(function(a){cannon.ASSETS["enemy{0}".format(a)]="images/enemy{0}.png".format(a)}),Math.PHI=1.61803399}(),cannon.ENEMY_DATA=[{texture:"enemy0",size:128,hp:8,expType:1,rotation:!1},{texture:"enemy1",size:64,hp:1,expType:0,rotation:!1},{texture:"enemy2",size:64,hp:1,expType:0,rotation:!1},{texture:"enemy3",size:64,hp:1,expType:0,rotation:!1},{texture:"enemy4",size:128,hp:8,expType:1,rotation:!1},{texture:"enemy5",size:128,hp:8,expType:1,rotation:!1},{texture:"enemy6",size:64,hp:1,expType:0,rotation:!1},{texture:"enemy7",size:64,hp:1,expType:0,rotation:!0},{texture:"enemy8",size:64,hp:1,expType:0,rotation:!0},{texture:"enemy9",size:64,hp:1,expType:0,rotation:!0},{texture:"enemy10",size:64,hp:1,expType:0,rotation:!0},{texture:"enemy11",size:64,hp:1,expType:0,rotation:!0},{texture:"enemy12",size:64,hp:1,expType:0,rotation:!0},{texture:"enemy13",size:64,hp:1,expType:0,rotation:!0},{texture:"enemy14",size:64,hp:1,expType:0,rotation:!0}],cannon.STAGE_DATA=[{terrain:{texture:"stage1",lines:[[383,-12,434,1],[433,-1,520,4],[520,4,656,-1],[656,-1,815,6],[815,6,986,-2],[1356,-6,1471,60],[1471,60,1496,59],[1496,59,1558,19],[1558,19,1661,-8],[1810,-8,1845,39],[1845,39,1885,14],[1885,14,1887,-12],[2180,-4,2209,13],[2209,13,2257,10],[2257,10,2271,16],[2271,16,2313,20],[2313,20,2337,12],[2337,12,2419,22],[2419,22,2447,31],[2447,31,2463,42],[2463,42,2553,43],[2552,43,2596,44],[2596,44,2633,36],[2633,36,2786,41],[2786,41,2847,43],[2847,43,2934,39],[2934,39,2997,42],[2997,42,3060,33],[3060,34,3242,25],[3241,23,3324,30],[3324,29,3392,18],[3392,18,3496,33],[3496,33,3554,34],[3554,34,3626,60],[3626,60,3678,75],[3674,73,3756,42],[3756,42,3912,23],[3912,23,4018,33],[4018,33,4102,39],[4102,39,4186,79],[4186,79,4242,87],[4238,89,4337,62],[4337,61,4442,56],[4442,56,4580,38],[4579,35,4612,43],[4612,43,4867,29],[4867,29,4880,23],[4880,23,5117,44],[5116,43,5245,27],[5245,27,5470,47],[5470,47,5558,31],[5558,31,5713,39],[5713,39,5742,33],[5742,33,5939,53],[5939,50,6166,61],[6166,61,6277,58],[6277,58,6426,54],[6426,53,6495,43],[6495,43,6648,55],[6648,55,6777,97],[6775,96,6902,160],[6902,161,6953,121],[6953,121,7058,57],[7058,57,7239,-6],[1848,665,1860,630],[1860,630,1936,632],[1934,630,1956,627],[1956,627,2058,623],[2058,623,2102,615],[2102,615,2188,609],[2188,609,2370,608],[2370,609,2607,622],[2607,622,2818,627],[2822,627,2909,611],[2909,610,3140,630],[3137,630,3232,615],[3232,615,3428,633],[3428,633,3766,614],[3765,614,3792,620],[3791,620,3943,602],[3942,602,4006,606],[4005,606,4138,567],[4137,564,4147,573],[4147,573,4204,580],[4203,579,4257,610],[4257,610,4428,634],[4430,633,4545,627],[4549,627,4611,619],[4611,619,4703,584],[4706,582,4802,618],[4802,618,4974,635],[4973,635,5057,630],[5056,629,5131,633],[5131,633,5339,623],[5338,623,5531,614],[5539,612,5585,615],[5589,617,5710,619],[5711,619,5818,611],[5818,611,5916,606],[5912,607,5928,615],[5927,615,5990,626],[5990,626,6158,624],[6158,624,6164,610],[6164,610,6203,630],[6203,630,6331,633],[6331,633,6356,626],[6356,626,6366,641],[6366,641,6470,621],[6470,621,6525,563],[6526,563,6536,563],[6536,563,6571,601],[6574,601,6630,618],[6638,619,6704,604],[6704,604,6824,550],[6824,550,6880,510],[6878,509,6917,513],[6915,512,7008,570],[7008,570,7109,611],[7109,611,7135,608],[7135,608,7170,630],[7170,630,7211,626],[7211,626,7305,641],[7305,641,7333,633],[7333,633,7394,657]],scrollSpeed:1},enemies:[{type:0,x:0,y:0}]}],cannon.onAssetsLoaded=function(a){return function(){return Array.range(0,15).forEach(function(a){var b="enemy{0}".format(a),c=tm.asset.Manager.get(b),d=tm.graphics.Canvas().resize(2*c.width,2*c.height);d.drawTexture(c,.5*c.width,.5*c.height,c.width,c.height),d.stackBlur(50);var e=tm.graphics.Canvas().resize(c.width,c.height);e.drawTexture(c,0,0),e.strokeStyle="transparent";for(var f=0;f<e.height;f+=3)e.clear(0,f,e.width,1);var g=tm.graphics.Canvas().resize(2*c.width*2,2*c.height);g.globalCompositeOperation="lighter",g.globalAlpha=.12;for(var a=0;10>a;a++)g.drawImage(d.canvas,0,0);g.globalCompositeOperation="source-over",g.globalAlpha=1,g.drawImage(e.canvas,.5*c.width,.5*c.height,c.width,c.height),g.globalCompositeOperation="lighter",g.globalAlpha=.12;for(var a=0;15>a;a++)g.drawImage(d.canvas,2*c.width,0);g.globalCompositeOperation="lighter",g.globalAlpha=1;for(var a=0;3>a;a++)g.drawImage(e.canvas,2.5*c.width,.5*c.height,c.width,c.height);tm.asset.Manager.set(b,g)}),a()}},tm.define("cannon.Application",{superClass:"tm.display.CanvasApp",init:function(a){this.superInit(a),this.keyboard.element.addEventListener("keydown",function(a){(37<=a.keyCode&&a.keyCode<=40||32===a.keyCode)&&a.preventDefault()},!1),this.canvas.imageSmoothingEnabled=!0,cannon.Application.SINGLETON=this}}),cannon.Application.SINGLETON=null,cannon.playSe=function(a){tm.asset.Manager.get("sounds/"+a).clone().setVolume(cannon.optionSettings.seVolume).play()},cannon.playBgm=function(a){tm.asset.Manager.get("sounds/"+a).clone().setVolume(cannon.optionSettings.bgmVolume).play()},tm.define("cannon.GameScene",{superClass:"tm.app.Scene",init:function(){this.superInit(),this.fromJSON({children:{backgroundLayer:{type:"tm.display.CanvasElement",children:{bg:{type:"cannon.Background"}}},playerLayer:{type:"tm.display.CanvasElement",children:{player:{type:"cannon.Fighter",scene:this,controllable:!1}}},terrainLayer:{type:"tm.display.CanvasElement",children:[{type:"cannon.Terrain",init:[cannon.STAGE_DATA[cannon.currentStage].terrain]}]},enemyLayer:{type:"tm.display.CanvasElement",children:{}},bulletLayer:{type:"tm.display.CanvasElement",children:{}}}}),this.scrollSpeed=cannon.STAGE_DATA[cannon.currentStage].terrain.scrollSpeed,this.player=this.playerLayer.player,this.launchPlayer()},update:function(a){var b,c,d=this,e=this.player,f=this.terrainLayer.children,g=this.backgroundLayer.children;f.forEach(function(a){a.scroll+=d.scrollSpeed}),g.forEach(function(a){a.scroll+=.5*d.scrollSpeed}),c=cannon.Enemy.ACTIVES.clone(),b=cannon.Shot.ACTIVES.clone();for(var h=0,i=b.length;i>h;h++)for(var j=b[h],k=0,l=c.length;l>k;k++){var m=c[k];if(j.isHitElement(m)&&!m.damage(cannon.SHOT_POWER)){j.damage();break}}c=cannon.Enemy.ACTIVES.clone();for(var h=0,n=c.length;n>h;h++){var m=c[h];e.isHitElement(m)&&e.damage()}f.some(function(a){return a.isHit(e)})&&e.damage(),b=cannon.Shot.ACTIVES.clone();for(var h=0,o=b.length;o>h;h++){var j=b[h];f.some(function(a){return a.isHit(j)})&&j.damage()}a.keyboard.getKeyDown("space")&&this.app.pushScene(cannon.PauseScene()),a.frame%120===0&&cannon.Enemy12().setPosition(1.1*cannon.SC_W,.5*cannon.SC_H).addChildTo(this.enemyLayer)},launchPlayer:function(){var a=this.player;a.tweener.clear().set({controllable:!1,x:cannon.SC_W*-.2}).to({x:.2*cannon.SC_W},2e3,"easeOutBack").call(function(){a.controllable=!0})}}),tm.define("cannon.MenuDialog",{superClass:"tm.ui.MenuDialog",init:function(a,b,c,d){this.superInit({title:a,menu:b,menuDesctiptions:c,defaultIndex:d||0,showExit:!0,screenWidth:cannon.SC_W,screenHeight:cannon.SC_H,backgroundColor:"hsla(200, 80%, 5%, 0.9)",boxColor:"hsla(200, 80%, 10%, 0.9)",cursorColor:"hsla(200, 80%, 30%, 0.9)"}),this.on("preselected",function(){cannon.playSe("extend")}),this.on("canceled",function(){cannon.playSe("extend")})}}),tm.define("cannon.PauseScene",{superClass:"tm.app.Scene",init:function(){this.superInit()},update:function(a){var b=a.keyboard;b.getKeyDown("space")&&this.app.popScene()}}),tm.define("cannon.TitleScene",{superClass:"tm.app.Scene",init:function(){this.superInit(),this.setInteractive(!0),this.fromJSON({children:{title:{type:"tm.display.Label",init:["ETA Boost",72],x:.5*cannon.SC_W,y:cannon.SC_H*(1-1/Math.PHI)}}})},onpointingend:function(){var a=this;cannon.app.pushScene(cannon.MenuDialog("MENU",["game start","option"],["ゲームスタート","設定"]).on("selected",function(b){switch(b.value){case"game start":a.startGame()}}))},startGame:function(){cannon.app.replaceScene(cannon.GameScene())}}),tm.define("cannon.Background",{superClass:"tm.display.CanvasElement",init:function(){this.superInit();var a=2,b=this;Array.range(0,3).forEach(function(c){tm.display.Sprite("test").setScale(a,2).setPosition(160*a*c,.5*cannon.SC_H).setAlpha(.4).addChildTo(b)}),this.scroll=0},update:function(){this.x=-this.scroll}}),tm.define("cannon.EffectSprite",{superClass:"tm.display.Sprite",init:function(a,b,c,d,e){this.superInit(a,b,c),this.setFrameIndex(0).setBlendMode("lighter"),this.f=0,this.finalIndex=d,this.frameIncr=e},update:function(){this.f+=this.frameIncr,this.frameIndex=~~this.f,this.f>=this.finalIndex&&this.remove()}}),tm.define("cannon.Explode",{superClass:"cannon.EffectSprite",init:function(a,b){this.superInit("explode0",128,128,64,1),this.setRotation(Math.rand(0,360)).setScale(1.5).setPosition(a,b)},onadded:function(){cannon.playSe("explode0")}}),tm.define("cannon.LargeExplode",{superClass:"cannon.EffectSprite",init:function(a,b){this.superInit("explode1",128,128,64,1),this.setRotation(Math.rand(0,360)).setScale(2.5).setPosition(a,b)},onadded:function(){cannon.playSe("explode1")}}),tm.define("cannon.ShockWave",{superClass:"cannon.EffectSprite",init:function(a,b){this.superInit("shockwave",64,64,64,2),this.setPosition(a,b)}}),tm.define("cannon.Spark",{superClass:"cannon.EffectSprite",init:function(a,b){this.superInit("spark",64,64,64,2),this.setPosition(a,b)}}),tm.define("cannon.Spark2",{superClass:"cannon.EffectSprite",init:function(a,b,c){this.superInit("spark2",128,128,25,c||1.5),this.setOrigin(.9,.5).setPosition(a,b)}}),tm.define("cannon.Boost",{superClass:"cannon.EffectSprite",init:function(a,b){this.superInit("boost",128,128,25,1),this.setPosition(a,b)}}),tm.define("cannon.Enemy",{superClass:"tm.display.Sprite",muteki:0,entered:!1,init:function(a,b){this.superInit(a,2*b,2*b),this.setFrameIndex(0).setBoundingType("circle").setBlendMode("lighter"),this.size=b,this.radius=.4*b,this.hp=5,cannon.Enemy.ACTIVES.push(this),this.on("removed",function(){cannon.Enemy.ACTIVES.erase(this)}),this.on("added",function(){this.entered=!1})},update:function(a){this.muteki=Math.max(0,this.muteki-1),this.setFrameIndex(this.muteki>0?a.frame%2:0),this.inScreen()&&(this.entered=!0),!this.inScreen()&&this.entered&&this.remove()},inScreen:function(){return 0<=this.x+this.size&&this.x-this.size<cannon.SC_W&&0<=this.y+this.size&&this.size-this.size<cannon.SC_H},damage:function(a){if(this.muteki<=0&&(this.hp-=a,this.muteki=10,this.hp<=0)){switch(this.expType){case 0:cannon.Explode(this.x,this.y).addChildTo(this.parent);break;case 1:cannon.LargeExplode(this.x,this.y).addChildTo(this.parent)}return this.remove(),!0}return!1}}),cannon.Enemy.ACTIVES=[],cannon.ENEMY_DATA.forEach(function(a,b){tm.define("cannon.Enemy{0}".format(b),{superClass:"cannon.Enemy",init:function(){this.superInit(a.texture,a.size),this.hp=a.hp,this.expType=a.expType,a.rotation&&this.on("enterframe",function(){this.rotation+=8})}})}),tm.define("cannon.Fighter",{superClass:"tm.display.CanvasElement",scene:null,controllable:!1,muteki:!1,direction:1,init:function(){this.superInit(),this.fromJSON({children:{backfire2:{type:"tm.display.Sprite",init:"backfire",originX:1,blendMode:"lighter"},backfire:{type:"tm.display.Sprite",init:["aura",80,120],frameIndex:0,x:-50,y:0,blendMode:"lighter"},body:{type:"tm.display.Sprite",init:["fighter",128,64],frameIndex:2,scaleX:.75,scaleY:.75}}}),this.setBoundingType("circle"),this.radius=cannon.FIGHTER_RADIUS,this.beforeX=this.x=cannon.SC_W*-.5,this.beforeY=this.y=.5*cannon.SC_H,this.roll=0,this.heat=0,this.gunPosition=0,this.backfire.update=function(a){this.visible&&(this.setFrameIndex(a.frame%4),this.scaleX=[.8,1,1.2,1][a.frame%4])},this.backfire2.update=function(a){this.visible&&(this.scaleX=[.8,1,1.2,1][a.frame%4])}},update:function(a){if(this.scaleX=this.direction,this.backfire.visible=this.backfire2.visible=!this.controllable,this.alpha=this.muteki?a.frame%4*.25+.25:1,this.controllable){var b=a.keyboard,c=b.getKeyDirection();this.position.add(c.mul(cannon.FIGHTER_SPEED)),this.x=Math.clamp(this.x,32,cannon.SC_W-32),this.y=Math.clamp(this.y,16,cannon.SC_H-16),c.y<0?this.roll-=.1:0<c.y?this.roll+=.1:(this.roll*=.9,-.01<this.roll&&this.roll<.01&&(this.roll=0));var d=b.getKeyDown("z"),e=b.getKeyDown("x");(d||e)&&(this.direction=e?1:-1,this.heat<=0&&(cannon.Shot(this.direction).setPosition(this.x+60*this.direction,this.y+7).addChildTo(this.parent),this.heat=cannon.HEAT_BY_SHOT,this.gunPosition=2),this.scaleX!==this.direction&&cannon.Boost(this.x,this.y).setPosition(-100,0).setScale(2,2).addChildTo(this)),this.heat>0&&(this.heat-=1,this.gunPosition=Math.max(this.gunPosition-.2,0),this.heat<=0&&cannon.playSe("reload"))}else this.roll*=.9,-.01<this.roll&&this.roll<.01&&(this.roll=0);this.roll=Math.clamp(this.roll,-2,2),this.body.setFrameIndex(3*~~(2+this.roll+.5)+~~(this.gunPosition+.5))},damage:function(){console.log("damage!"),!this.controllable||this.muteki}}),tm.define("cannon.Shot",{superClass:"tm.display.Sprite",direction:1,init:function(a){this.superInit("shot"),this.direction=a,this.setScale(5*this.direction,5),this.boundingType="circle",this.radius=cannon.SHOT_RADIUS;var b=this;this.on("added",function(){cannon.playSe("shot"),cannon.ShockWave(this.x,this.y).setScale(1*this.direction,4).on("enterframe",function(){this.x+=2*-b.direction}).addChildTo(this.parent),cannon.Spark(this.x,this.y).setRotation(Math.rand(0,360)).setScale(2*this.direction,2).addChildTo(this.parent),cannon.Spark2(this.x,this.y,3).setScale(2*this.direction,1).addChildTo(this.parent)}),cannon.Shot.ACTIVES.push(this),this.on("removed",function(){cannon.Shot.ACTIVES.erase(this)})},update:function(a){this.scaleY=5+a.frame%2,this.x+=cannon.SHOT_SPEED*this.direction,(this.x<0-this.radius||cannon.SC_W+this.radius<this.x)&&this.remove()},damage:function(){cannon.ShockWave(this.x,this.y).setScale(1*this.direction,4).addChildTo(this.parent),cannon.ShockWave(this.x,this.y).setScale(.75*this.direction,3).addChildTo(this.parent),cannon.Spark2(this.x,this.y).setScale(3*this.direction,3).addChildTo(this.parent),this.remove()}}),cannon.Shot.ACTIVES=[],tm.define("cannon.Terrain",{superClass:"tm.display.CanvasElement",init:function(a){this.superInit(),this.setOrigin(0,0),this.lines=[];for(var b=0,c=a.lines.length;c>b;b++)this.lines.push({a:tm.geom.Vector2(a.lines[b][0],a.lines[b][1]),b:tm.geom.Vector2(a.lines[b][2],a.lines[b][3])});this.scroll=0,this.strokeStyle="hsl(30, 80%, 80%)";var d=this;this.s=tm.display.Sprite(a.texture,8e3,640).setOrigin(0,0).setPosition(0,0).addChildTo(this).on("enterframe",function(){this.x=-d.scroll})},isHit:function(a){for(var b={x:a.x+this.scroll,y:a.y,radius:a.radius},c=this.lines,d=this.scroll,e=0,f=c.length;f>e;e++){var g=c[e],h=g.a,i=g.b;if((0<=h.x-d&&h.x-d<cannon.SC_W||0<=i.x-d&&i.x-d<cannon.SC_W)&&cannon.CollisionHelper.isHitCircleLine(b,g))return!0}return!1}}),tm.geom=tm.geom||{},function(){tm.define("tm.geom.Bezier",{vertices:null,init:function(a,b){b=b||10,this.vertices=[];for(var c=0;b>=c;c++){var d=tm.geom.Bezier.getPointOnCurve(a,c/b);this.vertices.push([d[0],d[1]])}}}),tm.geom.Bezier.getPointOnCurve=function(a,b){for(;a.length>1;){for(var c=[],d=0,e=a.length-1;e>d;d++)c[d]=[a[d][0]+(a[d+1][0]-a[d][0])*b,a[d][1]+(a[d+1][1]-a[d][1])*b];a=c}return a[0]}}(),cannon.CollisionHelper={isHitCircleLine:function(a,b){var c=tm.geom.Vector2,d=b.s||(b.s=c.sub(b.b,b.a)),e=c.sub(a,b.a),f=c.sub(a,b.b),g=a.radius*a.radius;return e.lengthSquared()<=g||f.lengthSquared()<=g?!0:Math.abs(c.cross(d,e))/d.length()>a.radius?!1:c.dot(e,d)*c.dot(f,d)<=0}},function(){function a(){this.r=0,this.g=0,this.b=0,this.a=0,this.next=null}tm.graphics.Canvas.prototype.stackBlur=function(d){var e=this.width,f=this.height,g=(this.canvas,this.context);if(!(isNaN(d)||1>d)){d|=0;var h;try{try{h=g.getImageData(0,0,e,f)}catch(i){try{netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead"),h=g.getImageData(0,0,e,f)}catch(i){throw alert("Cannot access local image"),new Error("unable to access local image data: "+i)}}}catch(i){throw alert("Cannot access image"),new Error("unable to access image data: "+i)}var j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H=h.data,I=d+d+1,J=e-1,K=f-1,L=d+1,M=L*(L+1)/2,N=new a,O=N;for(l=1;I>l;l++)if(O=O.next=new a,l==L)var P=O;O.next=N;var Q=null,R=null;p=o=0;var S=b[d],T=c[d];for(k=0;f>k;k++){for(y=z=A=B=q=r=s=t=0,u=L*(C=H[o]),v=L*(D=H[o+1]),w=L*(E=H[o+2]),x=L*(F=H[o+3]),q+=M*C,r+=M*D,s+=M*E,t+=M*F,O=N,l=0;L>l;l++)O.r=C,O.g=D,O.b=E,O.a=F,O=O.next;for(l=1;L>l;l++)m=o+((l>J?J:l)<<2),q+=(O.r=C=H[m])*(G=L-l),r+=(O.g=D=H[m+1])*G,s+=(O.b=E=H[m+2])*G,t+=(O.a=F=H[m+3])*G,y+=C,z+=D,A+=E,B+=F,O=O.next;for(Q=N,R=P,j=0;e>j;j++)H[o+3]=F=t*S>>T,0!=F?(F=255/F,H[o]=(q*S>>T)*F,H[o+1]=(r*S>>T)*F,H[o+2]=(s*S>>T)*F):H[o]=H[o+1]=H[o+2]=0,q-=u,r-=v,s-=w,t-=x,u-=Q.r,v-=Q.g,w-=Q.b,x-=Q.a,m=p+((m=j+d+1)<J?m:J)<<2,y+=Q.r=H[m],z+=Q.g=H[m+1],A+=Q.b=H[m+2],B+=Q.a=H[m+3],q+=y,r+=z,s+=A,t+=B,Q=Q.next,u+=C=R.r,v+=D=R.g,w+=E=R.b,x+=F=R.a,y-=C,z-=D,A-=E,B-=F,R=R.next,o+=4;p+=e}for(j=0;e>j;j++){for(z=A=B=y=r=s=t=q=0,o=j<<2,u=L*(C=H[o]),v=L*(D=H[o+1]),w=L*(E=H[o+2]),x=L*(F=H[o+3]),q+=M*C,r+=M*D,s+=M*E,t+=M*F,O=N,l=0;L>l;l++)O.r=C,O.g=D,O.b=E,O.a=F,O=O.next;for(n=e,l=1;d>=l;l++)o=n+j<<2,q+=(O.r=C=H[o])*(G=L-l),r+=(O.g=D=H[o+1])*G,s+=(O.b=E=H[o+2])*G,t+=(O.a=F=H[o+3])*G,y+=C,z+=D,A+=E,B+=F,O=O.next,K>l&&(n+=e);for(o=j,Q=N,R=P,k=0;f>k;k++)m=o<<2,H[m+3]=F=t*S>>T,F>0?(F=255/F,H[m]=(q*S>>T)*F,H[m+1]=(r*S>>T)*F,H[m+2]=(s*S>>T)*F):H[m]=H[m+1]=H[m+2]=0,q-=u,r-=v,s-=w,t-=x,u-=Q.r,v-=Q.g,w-=Q.b,x-=Q.a,m=j+((m=k+L)<K?m:K)*e<<2,q+=y+=Q.r=H[m],r+=z+=Q.g=H[m+1],s+=A+=Q.b=H[m+2],t+=B+=Q.a=H[m+3],Q=Q.next,u+=C=R.r,v+=D=R.g,w+=E=R.b,x+=F=R.a,y-=C,z-=D,A-=E,B-=F,R=R.next,o+=e}return g.putImageData(h,0,0),this}};var b=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],c=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24]}(),tm.main(function(){cannon.app=cannon.Application("#main"),cannon.app.fps=60,cannon.app.resize(cannon.SC_W,cannon.SC_H).fitWindow().replaceScene(tm.ui.LoadingScene({width:cannon.SC_W,height:cannon.SC_H,assets:cannon.ASSETS,nextScene:cannon.onAssetsLoaded(cannon.GameScene)})),"localhost"===location.hostname&&(tm.util.Script.loadStats().onload=function(){cannon.app.enableStats()});var a=document.createElement("span");a.style.fontFamily="'OFL', 'monospace'",a.innerHTML="QW@HhsXJ",document.body.appendChild(a);var b=a.offsetWidth,c=20,d=function(){c-=1,a.offsetWidth!==b||0>c?(document.body.removeChild(a),cannon.app.run()):setTimeout(d,100)};d()});
//# sourceMappingURL=cannon-stg.min.js.map